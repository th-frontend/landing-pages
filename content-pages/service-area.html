<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Service Area – Connecticut &amp; Westchester County</title>
  <meta name="description" content="Check whether we serve your city in Connecticut or Westchester County, NY." />
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

  <style>
    :root {
      --bg: #f5f7fb;
      --surface: #ffffff;
      --ink: #101828;
      --muted: #475467;
      --accent: #d61f2c;
      --accent-dark: #aa1c23;
      --brand: #113a6a;
      --border: #d8dee8;
      --radius: 16px;
      --shadow: 0 18px 36px rgba(16, 26, 53, 0.08);
      --container: min(1100px, 92vw);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Manrope", system-ui, -apple-system, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--ink);
      line-height: 1.6;
    }

    img {
      max-width: 100%;
      display: block;
    }

    a {
      color: inherit;
    }

    .container {
      width: var(--container);
      margin-inline: auto;
    }

    header.page-hero {
      background: radial-gradient(circle at top left, rgba(214, 31, 44, 0.18), transparent 55%),
        linear-gradient(180deg, #ffffff 0%, #eef2fb 100%);
      padding: clamp(28px, 6vw, 64px) 0;
    }

    .hero-shell {
      display: grid;
      gap: clamp(20px, 4vw, 32px);
    }

    @media (min-width: 900px) {
      .hero-shell {
        grid-template-columns: minmax(0, 1.4fr) minmax(260px, 1fr);
        align-items: start;
      }
    }

    .hero-shell h1 {
      margin: 0;
      font-size: clamp(32px, 5vw, 48px);
      line-height: 1.08;
      color: var(--brand);
    }

    .hero-shell p {
      margin: 12px 0 24px;
      color: var(--muted);
      max-width: 60ch;
    }

    .hero-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 24px;
    }

    .hero-tags span {
      background: rgba(16, 58, 106, 0.08);
      border: 1px solid rgba(16, 58, 106, 0.16);
      color: var(--brand);
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .hero-copy {
      display: grid;
      gap: 18px;
    }

    .hero-map-card {
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: clamp(18px, 3vw, 26px);
      display: grid;
      gap: 10px;
    }

    .hero-map-card p {
      margin: 0;
      color: var(--muted);
      font-size: 0.9rem;
    }

    .hero-map {
      height: clamp(220px, 30vw, 320px);
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid rgba(17, 58, 106, 0.18);
    }

    .hero-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 18px;
      border-radius: 12px;
      border: 1px solid transparent;
      font-weight: 700;
      text-decoration: none;
      cursor: pointer;
    }

    .btn-primary {
      background: var(--accent);
      color: #fff;
      box-shadow: 0 16px 24px rgba(214, 31, 44, 0.18);
    }

    .btn-primary:hover {
      background: var(--accent-dark);
    }

    .btn-ghost {
      background: #fff;
      border-color: rgba(16, 58, 106, 0.18);
      color: var(--brand);
    }

    .finder {
      margin-top: clamp(-32px, -5vw, -56px);
      position: relative;
      z-index: 5;
    }

    .finder-card {
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: clamp(24px, 4vw, 36px);
      display: grid;
      gap: 18px;
    }

    .finder-card h2 {
      margin: 0;
      font-size: clamp(24px, 3.5vw, 32px);
      color: var(--brand);
    }

    .finder-form {
      display: grid;
      gap: 16px;
    }

    @media (min-width: 720px) {
      .finder-form {
        grid-template-columns: repeat(4, minmax(0, 1fr));
        align-items: end;
      }
    }


    label {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--muted);
      display: block;
      margin-bottom: 6px;
    }

    input,
    select {
      width: 100%;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid var(--border);
      font: inherit;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }

    input:focus,
    select:focus {
      outline: none;
      border-color: rgba(214, 31, 44, 0.4);
      box-shadow: 0 0 0 4px rgba(214, 31, 44, 0.12);
    }

    .coverage {
      padding: clamp(40px, 7vw, 72px) 0;
    }

    .coverage-grid {
      display: grid;
      gap: clamp(24px, 4vw, 36px);
      grid-template-columns: minmax(0, 1fr);
    }

    @media (min-width: 940px) {
      .coverage-grid {
        grid-template-columns: minmax(0, 1fr) minmax(260px, 360px);
      }
    }

    .list-card,
    .showcase-card {
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: clamp(20px, 3vw, 28px);
    }

    .showcase-card {
      display: grid;
      gap: 14px;
      align-content: start;
    }

    .showcase-card[hidden] {
      display: none;
    }

    .showcase-header {
      display: grid;
      gap: 6px;
    }

    .showcase-header h2 {
      margin: 0;
      font-size: clamp(20px, 2.6vw, 26px);
      color: var(--brand);
    }

    .showcase-header p {
      margin: 0;
      color: var(--muted);
      font-size: 0.9rem;
    }

    .showcase-media {
      display: grid;
      gap: 12px;
    }

    .showcase-media img {
      width: 100%;
      border-radius: 12px;
      border: 1px solid var(--border);
      box-shadow: 0 12px 24px rgba(16, 26, 53, 0.12);
    }

    .showcase-list {
      display: grid;
      gap: 10px;
      padding: 0;
      margin: 0;
      list-style: none;
    }

    .showcase-list li {
      color: var(--muted);
      font-size: 0.9rem;
      border-left: 3px solid rgba(214, 31, 44, 0.45);
      padding-left: 12px;
    }

    .showcase-list strong {
      font-weight: 700;
      color: var(--brand);
      margin-right: 6px;
    }

    .showcase-list a {
      color: var(--brand);
      font-weight: 600;
      text-decoration: none;
    }

    .showcase-list a:hover,
    .showcase-list a:focus-visible {
      text-decoration: underline;
    }

    .showcase-cta {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-weight: 700;
      color: var(--accent);
      text-decoration: none;
      font-size: 0.88rem;
    }

    .showcase-cta svg {
      width: 16px;
      height: 16px;
    }

    .list-header {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 18px;
    }

    .list-header p {
      margin: 0;
      color: var(--muted);
    }

    details.county {
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #fff;
      margin-bottom: 12px;
      overflow: hidden;
    }

    summary {
      padding: 14px 18px;
      font-weight: 700;
      cursor: pointer;
      list-style: none;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    summary::after {
      content: "";
      width: 10px;
      height: 10px;
      border-right: 2px solid var(--ink);
      border-bottom: 2px solid var(--ink);
      transform: rotate(45deg);
      transition: transform 0.2s ease;
    }

    details[open] summary::after {
      transform: rotate(-135deg);
    }

    .city-grid {
      padding: 0 18px 18px;
      display: grid;
      gap: 14px;
    }

    .city-row {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 14px;
      padding: 16px 18px;
      border: 1px solid var(--border);
      border-radius: 14px;
      text-decoration: none;
      color: inherit;
      background: #fff;
      transition: border-color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
    }

    .city-row:hover,
    .city-row:focus-visible {
      border-color: rgba(17, 58, 106, 0.26);
      box-shadow: 0 20px 36px rgba(16, 26, 53, 0.12);
      transform: translateY(-2px);
    }

    .city-row:focus-visible {
      outline: 3px solid rgba(17, 58, 106, 0.2);
      outline-offset: 2px;
    }

    @media (min-width: 720px) {
      .city-row {
        grid-template-columns: minmax(0, 1fr) auto;
        align-items: center;
      }
    }

    .city-main {
      display: grid;
      gap: 12px;
    }

    .city-heading {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    .city-name {
      font-weight: 700;
      color: var(--brand);
      font-size: 1.05rem;
    }

    .city-flagship {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(214, 31, 44, 0.12);
      color: var(--accent);
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.02em;
    }

    .city-services {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .service-tag {
      background: rgba(17, 58, 106, 0.08);
      color: var(--brand);
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 0.78rem;
      font-weight: 600;
      line-height: 1.2;
    }

    .city-meta {
      display: grid;
      gap: 6px;
      color: var(--muted);
      font-size: 0.8rem;
      text-align: left;
    }

    @media (min-width: 720px) {
      .city-meta {
        justify-items: end;
        text-align: right;
      }
    }

    .city-review {
      font-style: italic;
    }

    .city-cta {
      font-weight: 700;
      color: var(--accent);
      font-size: 0.85rem;
    }

    .county-summary {
      padding: 12px 18px 0;
      color: var(--muted);
      font-size: 0.85rem;
    }

    .county-summary strong {
      color: var(--brand);
    }

    .county-summary a {
      color: var(--accent);
      font-weight: 600;
      text-decoration: none;
    }

    .county-summary a:hover,
    .county-summary a:focus-visible {
      text-decoration: underline;
    }

    .why {
      padding: clamp(32px, 6vw, 64px) 0;
      background: linear-gradient(180deg, rgba(17, 58, 106, 0.04) 0%, rgba(17, 58, 106, 0) 100%);
    }

    .why-grid {
      display: grid;
      gap: clamp(16px, 3vw, 24px);
    }

    @media (min-width: 720px) {
      .why-grid {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    .why-card {
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: clamp(18px, 3vw, 24px);
      display: grid;
      align-content: start;
      gap: 12px;
    }

    .why-icon {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: rgba(214, 31, 44, 0.12);
      color: var(--accent);
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .why-icon svg {
      width: 22px;
      height: 22px;
    }

    .why-card h3 {
      margin: 0;
      font-size: 1.05rem;
      color: var(--brand);
    }

    .why-card p {
      margin: 0;
      color: var(--muted);
      font-size: 0.9rem;
    }

    .services {
      padding: clamp(32px, 6vw, 64px) 0;
    }

    .services-grid {
      display: grid;
      gap: clamp(16px, 3vw, 22px);
    }

    @media (min-width: 720px) {
      .services-grid {
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      }
    }

    .service-card {
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: clamp(18px, 3vw, 24px);
      display: grid;
      gap: 10px;
    }

    .service-card h3 {
      margin: 0;
      font-size: 1.05rem;
      color: var(--brand);
    }

    .service-card p {
      margin: 0;
      color: var(--muted);
      font-size: 0.9rem;
    }

    .section-head {
      display: grid;
      gap: 10px;
      text-align: center;
      margin-bottom: clamp(18px, 3vw, 26px);
    }

    .section-head h2 {
      margin: 0;
      font-size: clamp(24px, 3vw, 32px);
      color: var(--brand);
    }

    .section-head p {
      margin: 0;
      color: var(--muted);
      max-width: 62ch;
      justify-self: center;
    }

    .proof {
      padding: clamp(32px, 6vw, 56px) 0;
    }

    .proof-grid {
      display: grid;
      gap: clamp(18px, 3vw, 28px);
    }

    @media (min-width: 720px) {
      .proof-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .proof-card {
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: clamp(20px, 3vw, 28px);
    }

    .proof-card h3 {
      margin: 0 0 10px;
      font-size: 1.2rem;
    }

    .proof-card p {
      margin: 6px 0;
      color: var(--muted);
      font-size: 0.95rem;
    }

    .faq {
      padding: clamp(32px, 6vw, 56px) 0;
    }

    .faq details {
      margin-bottom: 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--surface);
      box-shadow: var(--shadow);
    }

    .faq summary {
      padding: 16px 20px;
    }

    .faq p {
      padding: 0 20px 18px;
      margin: 0;
      color: var(--muted);
    }

    .cta-strip {
      background: linear-gradient(135deg, var(--brand), #0c223d);
      color: #fff;
      padding: clamp(32px, 6vw, 52px) 0;
    }

    .cta-strip .shell {
      display: grid;
      gap: 16px;
      align-items: center;
      justify-items: center;
      text-align: center;
    }

    @media (min-width: 720px) {
      .cta-strip .shell {
        grid-template-columns: 1fr auto;
        text-align: left;
        justify-items: start;
      }
    }
  </style>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet" />
</head>
<body>
  <header class="page-hero">
    <div class="container hero-shell">
      <div class="hero-copy">
        <h1>Serving every corner of Connecticut and Westchester County, NY.</h1>
        <p>Search by city, ZIP, service, or county to see how quickly we can be on site. If you do not see your community listed, give us a call—there is a strong chance we already work there.</p>
        <div class="hero-tags">
          <span>Same-week inspections</span>
          <span>Emergency leak response</span>
          <span>4.9 out of 5 homeowner reviews</span>
        </div>
        <div class="hero-actions">
          <a class="btn btn-primary" href="#finder">Free estimate</a>
          <a class="btn btn-ghost" href="tel:1-203-723-1372">Call 1-203-723-1372</a>
        </div>
      </div>
      <aside class="hero-map-card" aria-label="Coverage highlight">
        <strong style="font-size:1.05rem">Coverage snapshot</strong>
        <p>View our daily service footprint across Connecticut and Westchester County, NY.</p>
        <div class="hero-map" id="heroCoverageMap" role="presentation" aria-hidden="true"></div>
      </aside>
    </div>
  </header>

  <section class="finder" id="finder">
    <div class="container finder-card" role="search">
      <h2>Find out if we service your address</h2>
      <form class="finder-form" id="coverageForm">
        <div>
          <label for="cityZip">City or ZIP</label>
          <input id="cityZip" name="city" placeholder="e.g. Stamford or 06902" inputmode="search" />
        </div>
        <div>
          <label for="serviceSelect">Service</label>
          <select id="serviceSelect" name="service">
            <option value="">All services</option>
            <option>Basement Waterproofing</option>
            <option>Foundation Repair</option>
            <option>Crawl Space Repair</option>
            <option>Concrete Leveling</option>
            <option>Basement Finishing</option>
          </select>
        </div>
        <div>
          <label for="countySelect">County</label>
          <select id="countySelect" name="county">
            <option value="">All counties</option>
            <option>Fairfield</option>
            <option>Hartford</option>
            <option>Litchfield</option>
            <option>Middlesex</option>
            <option>New Haven</option>
            <option>New London</option>
            <option>Tolland</option>
            <option>Windham</option>
            <option>Westchester</option>
          </select>
        </div>
        <div>
          <button class="btn btn-primary" type="submit">Show matches</button>
        </div>
      </form>
    </div>
  </section>

  <section class="coverage" aria-label="Coverage results and project highlights">
    <div class="container coverage-grid">
      <section class="list-card" aria-live="polite">
        <div class="list-header">
          <h2 style="margin:0">Cities we serve</h2>
          <p><span id="resultCount">0</span> communities match your filters.</p>
        </div>
        <div id="countyList"></div>
      </section>
      <aside class="showcase-card" id="searchShowcase" aria-live="polite" hidden>
        <div class="showcase-header">
          <h2>Project highlights</h2>
          <p>Enter a city or ZIP to see reviews and recent projects in your area.</p>
        </div>
        <div class="showcase-media" id="showcaseMedia"></div>
        <ul class="showcase-list" id="showcaseList"></ul>
        <a class="showcase-cta" id="showcaseLink" href="#" rel="noopener" target="_blank" hidden>
          <span class="showcase-cta-label">View more on ConnecticutBasementSystems.com</span>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M7 17l9.2-9.2"></path>
            <path d="M9 7h7v7"></path>
          </svg>
        </a>
      </aside>
    </div>
  </section>

  <section class="why" aria-label="Why homeowners choose us">
    <div class="container">
      <div class="section-head">
        <h2>Why homeowners choose us</h2>
        <p>Local crews, rapid scheduling, and fully warranted systems keep projects on track from inspection to install.</p>
      </div>
      <div class="why-grid">
        <article class="why-card">
          <span class="why-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3.5" y="4.5" width="17" height="16" rx="2.2"></rect>
              <path d="M8 2.5v4"></path>
              <path d="M16 2.5v4"></path>
              <path d="M3.5 10.5h17"></path>
              <path d="M9 14h2"></path>
            </svg>
          </span>
          <h3>Same-week availability</h3>
          <p>Coverage data is fed by our actual schedule, so we can commit to on-site consultations within days.</p>
        </article>
        <article class="why-card">
          <span class="why-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 3.2l7 2.4v5.8c0 4.6-3 8.8-7 10.4-4-1.6-7-5.8-7-10.4V5.6z"></path>
              <path d="M9.2 11.7l2.2 2.1 3.4-4.1"></path>
            </svg>
          </span>
          <h3>Certified specialists</h3>
          <p>Each crew trains directly with the manufacturers behind our systems for waterproofing, structural, and concrete repair.</p>
        </article>
        <article class="why-card">
          <span class="why-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 21s-5-5.2-5-8.5a5 5 0 1 1 10 0c0 3.3-5 8.5-5 8.5z"></path>
              <circle cx="12" cy="12.5" r="1.8"></circle>
            </svg>
          </span>
          <h3>Truly local coverage</h3>
          <p>Teams are staged in every county we serve, so travel time is short and repeat visits are easy.</p>
        </article>
      </div>
    </div>
  </section>

  <section class="services" aria-label="Featured services">
    <div class="container">
      <div class="section-head">
        <h2>Services across Connecticut &amp; Westchester</h2>
        <p>Every installation crew brings purpose-built tools and materials for the project type you choose.</p>
      </div>
      <div class="services-grid">
        <article class="service-card">
          <h3>Basement Waterproofing</h3>
          <p>Interior drains, sump systems, and moisture control keep your basement dry after every storm.</p>
        </article>
        <article class="service-card">
          <h3>Foundation Repair</h3>
          <p>Piers, wall bracing, and structural reinforcements stabilise settling homes and stop new cracks.</p>
        </article>
        <article class="service-card">
          <h3>Crawl Space Repair</h3>
          <p>Encapsulation, drainage, and support jacks protect air quality and the structure above.</p>
        </article>
        <article class="service-card">
          <h3>Concrete Leveling</h3>
          <p>Lightweight polyurethane lifting levels sidewalks, slabs, and pool decks without downtime.</p>
        </article>
        <article class="service-card">
          <h3>Basement Finishing</h3>
          <p>Waterproof wall, floor, and ceiling systems transform basements into healthy living space.</p>
        </article>
      </div>
    </div>
  </section>

  <section class="proof">
    <div class="container proof-grid">
      <article class="proof-card">
        <h3>Recent jobs nearby</h3>
        <p>Norwalk, CT • Sump system &amp; WaterGuard • Aug 23, 2025</p>
        <p>Danbury, CT • Foundation piering • Aug 20, 2025</p>
        <p>Scarsdale, NY • Concrete leveling • Aug 12, 2025</p>
      </article>
      <article class="proof-card">
        <h3>Reviews from Connecticut homeowners</h3>
        <p>“Incredible crew. Dry basement after the first storm.” <br /><small style="color:var(--muted)">– New Haven, CT</small></p>
        <p>“Professional, on time, and clean.” <br /><small style="color:var(--muted)">– Greenwich, CT</small></p>
      </article>
    </div>
  </section>

  <section class="faq" aria-label="Frequently asked questions">
    <div class="container">
      <details open>
        <summary>Do you service my town?</summary>
        <p>Yes. We cover every city and town in Connecticut along with all of Westchester County, NY. Use the search form above to confirm and schedule.</p>
      </details>
      <details>
        <summary>What services are available?</summary>
        <p>Basement waterproofing, foundation repair, crawl space repair, concrete leveling, and basement finishing. Availability may vary by project type—call us for specifics.</p>
      </details>
      <details>
        <summary>How soon can you visit?</summary>
        <p>Most inspections are scheduled within the same week. Emergency requests are prioritised—call for immediate assistance.</p>
      </details>
    </div>
  </section>

  <div class="cta-strip" role="region" aria-label="Book an estimate">
    <div class="container shell">
      <strong>Evening and weekend appointments available.</strong>
      <div class="hero-actions">
        <a class="btn btn-ghost" href="tel:1-203-723-1372">Call 1-203-723-1372</a>
        <a class="btn btn-primary" href="#finder">Request my free estimate</a>
      </div>
    </div>
  </div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <script>
    const coverageData = [
      { id: 1, city: 'Stamford', state: 'CT', county: 'Fairfield', lat: 41.0534, lng: -73.5387, services: ['Basement Waterproofing', 'Foundation Repair', 'Concrete Leveling'] },
      { id: 2, city: 'Bridgeport', state: 'CT', county: 'Fairfield', lat: 41.1792, lng: -73.1894, services: ['Basement Waterproofing', 'Crawl Space Repair'] },
      { id: 3, city: 'Norwalk', state: 'CT', county: 'Fairfield', lat: 41.1177, lng: -73.4079, services: ['Basement Waterproofing', 'Foundation Repair'] },
      { id: 4, city: 'Danbury', state: 'CT', county: 'Fairfield', lat: 41.3948, lng: -73.454, services: ['Foundation Repair', 'Concrete Leveling'] },
      { id: 5, city: 'Greenwich', state: 'CT', county: 'Fairfield', lat: 41.0262, lng: -73.6282, services: ['Basement Waterproofing', 'Foundation Repair', 'Basement Finishing'] },
      { id: 6, city: 'New Canaan', state: 'CT', county: 'Fairfield', lat: 41.1468, lng: -73.4948, services: ['Basement Waterproofing', 'Crawl Space Repair'] },

      { id: 7, city: 'Hartford', state: 'CT', county: 'Hartford', lat: 41.7658, lng: -72.6734, services: ['Basement Waterproofing', 'Foundation Repair'] },
      { id: 8, city: 'West Hartford', state: 'CT', county: 'Hartford', lat: 41.762, lng: -72.742, services: ['Basement Waterproofing', 'Crawl Space Repair'] },
      { id: 9, city: 'East Hartford', state: 'CT', county: 'Hartford', lat: 41.7634, lng: -72.612, services: ['Foundation Repair', 'Concrete Leveling'] },
      { id: 10, city: 'New Britain', state: 'CT', county: 'Hartford', lat: 41.6612, lng: -72.7795, services: ['Basement Waterproofing', 'Basement Finishing'] },
      { id: 11, city: 'Glastonbury', state: 'CT', county: 'Hartford', lat: 41.7123, lng: -72.608, services: ['Basement Waterproofing', 'Crawl Space Repair'] },
      { id: 12, city: 'Manchester', state: 'CT', county: 'Hartford', lat: 41.7759, lng: -72.5215, services: ['Foundation Repair', 'Concrete Leveling'] },

      { id: 13, city: 'Waterbury', state: 'CT', county: 'New Haven', lat: 41.5582, lng: -73.0515, services: ['Foundation Repair', 'Concrete Leveling'] },
      { id: 14, city: 'New Haven', state: 'CT', county: 'New Haven', lat: 41.3083, lng: -72.9279, services: ['Basement Waterproofing', 'Foundation Repair'] },
      { id: 15, city: 'Milford', state: 'CT', county: 'New Haven', lat: 41.2307, lng: -73.064, services: ['Basement Waterproofing', 'Crawl Space Repair'] },
      { id: 16, city: 'Hamden', state: 'CT', county: 'New Haven', lat: 41.3959, lng: -72.8968, services: ['Basement Waterproofing', 'Crawl Space Repair'] },
      { id: 17, city: 'Meriden', state: 'CT', county: 'New Haven', lat: 41.5382, lng: -72.807, services: ['Foundation Repair', 'Concrete Leveling'] },
      { id: 18, city: 'West Haven', state: 'CT', county: 'New Haven', lat: 41.2707, lng: -72.946, services: ['Basement Waterproofing', 'Foundation Repair'] },

      { id: 19, city: 'Middletown', state: 'CT', county: 'Middlesex', lat: 41.5623, lng: -72.6506, services: ['Basement Waterproofing', 'Crawl Space Repair', 'Concrete Leveling'] },
      { id: 20, city: 'Cromwell', state: 'CT', county: 'Middlesex', lat: 41.5951, lng: -72.6454, services: ['Foundation Repair', 'Concrete Leveling'] },
      { id: 21, city: 'Old Saybrook', state: 'CT', county: 'Middlesex', lat: 41.2915, lng: -72.3762, services: ['Basement Waterproofing', 'Crawl Space Repair'] },

      { id: 22, city: 'New London', state: 'CT', county: 'New London', lat: 41.3557, lng: -72.0995, services: ['Basement Waterproofing', 'Foundation Repair'] },
      { id: 23, city: 'Norwich', state: 'CT', county: 'New London', lat: 41.5243, lng: -72.0759, services: ['Foundation Repair', 'Concrete Leveling'] },
      { id: 24, city: 'Groton', state: 'CT', county: 'New London', lat: 41.3501, lng: -72.0782, services: ['Basement Waterproofing', 'Crawl Space Repair'] },
      { id: 25, city: 'Waterford', state: 'CT', county: 'New London', lat: 41.3418, lng: -72.1356, services: ['Basement Waterproofing', 'Foundation Repair'] },

      { id: 26, city: 'Torrington', state: 'CT', county: 'Litchfield', lat: 41.8007, lng: -73.1212, services: ['Foundation Repair', 'Concrete Leveling'] },
      { id: 27, city: 'New Milford', state: 'CT', county: 'Litchfield', lat: 41.577, lng: -73.4085, services: ['Basement Waterproofing', 'Crawl Space Repair'] },
      { id: 28, city: 'Litchfield', state: 'CT', county: 'Litchfield', lat: 41.7473, lng: -73.1887, services: ['Basement Waterproofing', 'Foundation Repair'] },
      { id: 29, city: 'Thomaston', state: 'CT', county: 'Litchfield', lat: 41.6737, lng: -73.0743, services: ['Foundation Repair', 'Concrete Leveling'] },

      { id: 30, city: 'Vernon', state: 'CT', county: 'Tolland', lat: 41.8665, lng: -72.4495, services: ['Basement Waterproofing', 'Foundation Repair'] },
      { id: 31, city: 'Tolland', state: 'CT', county: 'Tolland', lat: 41.8715, lng: -72.3687, services: ['Basement Waterproofing', 'Crawl Space Repair'] },
      { id: 32, city: 'Ellington', state: 'CT', county: 'Tolland', lat: 41.9037, lng: -72.4698, services: ['Foundation Repair', 'Concrete Leveling'] },

      { id: 33, city: 'Windham', state: 'CT', county: 'Windham', lat: 41.6998, lng: -72.157, services: ['Basement Waterproofing', 'Foundation Repair'] },
      { id: 34, city: 'Putnam', state: 'CT', county: 'Windham', lat: 41.9151, lng: -71.9087, services: ['Basement Waterproofing', 'Crawl Space Repair'] },
      { id: 35, city: 'Killingly', state: 'CT', county: 'Windham', lat: 41.8415, lng: -71.887, services: ['Foundation Repair', 'Concrete Leveling'] },

      { id: 36, city: 'White Plains', state: 'NY', county: 'Westchester', lat: 41.033, lng: -73.7629, services: ['Foundation Repair', 'Concrete Leveling', 'Basement Waterproofing'] },
      { id: 37, city: 'Yonkers', state: 'NY', county: 'Westchester', lat: 40.9312, lng: -73.8988, services: ['Basement Waterproofing', 'Foundation Repair'] },
      { id: 38, city: 'New Rochelle', state: 'NY', county: 'Westchester', lat: 40.9115, lng: -73.7824, services: ['Basement Waterproofing', 'Crawl Space Repair'] },
      { id: 39, city: 'Mount Vernon', state: 'NY', county: 'Westchester', lat: 40.9126, lng: -73.8371, services: ['Foundation Repair', 'Concrete Leveling'] },
      { id: 40, city: 'Port Chester', state: 'NY', county: 'Westchester', lat: 41.0018, lng: -73.6657, services: ['Basement Waterproofing', 'Foundation Repair'] }
    ];

    const cityMeta = new Map([
      ['Stamford, CT', { flagshipService: 'Coastal Waterproofing', responseTime: '24 hours', reviewSnippet: 'Crew had us dry after Ida.' }],
      ['Bridgeport, CT', { responseTime: '1-2 days', reviewSnippet: 'Basement stayed dry all season.' }],
      ['Danbury, CT', { flagshipService: 'Foundation Piers', responseTime: '48 hours', reviewSnippet: 'Resolved cracks quickly.' }],
      ['Hartford, CT', { flagshipService: 'Historic Basement Care', responseTime: '1-2 days', reviewSnippet: 'Respectful of our 1920s home.' }],
      ['New Haven, CT', { responseTime: 'Same-week availability', reviewSnippet: 'Kept our basement ready for tenants.' }],
      ['Middletown, CT', { flagshipService: 'Riverfront Waterproofing', responseTime: '2 days' }],
      ['New London, CT', { responseTime: 'Next day', reviewSnippet: 'Team knew exactly what to do.' }],
      ['Torrington, CT', { responseTime: '2-3 days', flagshipService: 'Frost Heave Repair' }],
      ['White Plains, NY', { responseTime: '24-48 hours', reviewSnippet: 'Walked us through every step.' }],
      ['Yonkers, NY', { flagshipService: 'Brick Foundation Repair', responseTime: '1-2 days' }],
      ['Mount Vernon, NY', { responseTime: '1-2 days', reviewSnippet: 'Tight timeline met without issue.' }],
      ['Port Chester, NY', { reviewSnippet: 'Crew finished ahead of schedule.', responseTime: '2 days' }]
    ]);

    function slugifyCityName(name) {
      return name
        .toLowerCase()
        .replace(/&/g, 'and')
        .replace(/[^a-z0-9]+/g, '-')
        .replace(/^-+|-+$/g, '');
    }

    coverageData.forEach(item => {
      const key = `${item.city}, ${item.state}`;
      const meta = cityMeta.get(key) || {};
      item.url = meta.url || `/service-area/${slugifyCityName(item.city)}-${item.state.toLowerCase()}/`;
      item.flagshipService = meta.flagshipService || '';
      item.responseTime = meta.responseTime || '1-2 business days';
      item.reviewSnippet = meta.reviewSnippet || '';
    });

    const showcaseData = new Map([
      ['DEFAULT', {
        heading: 'Project highlights',
        summary: 'Enter a city or ZIP to see reviews and recent projects in your area.',
        image: {
          src: 'https://cdn.treehouseinternetgroup.com/cms_images/7/customer-handshake.jpg',
          alt: 'Connecticut Basement Systems inspector meeting with a homeowner'
        },
        bullets: [
          { type: 'Review', text: '4.9/5 average rating from homeowners across Connecticut and Westchester County.', href: 'https://www.connecticutbasementsystems.com/about-us/reviews.html' },
          { type: 'Project', text: 'See waterproofing, foundation, and crawl space transformations across the region.', href: 'https://www.connecticutbasementsystems.com/about-us/before-after.html' }
        ],
        cta: { label: 'Explore all reviews & galleries', href: 'https://www.connecticutbasementsystems.com/about-us/photo-gallery.html' }
      }],
      ['Stamford, CT', {
        heading: 'Stamford projects & reviews',
        summary: 'Coastal neighborhoods rely on WaterGuard and TripleSafe systems to stay ahead of tidal groundwater.',
        image: {
          src: 'https://cdn.treehouseinternetgroup.com/cdn-cgi/image/format=auto/cms_images/7/bw-new-srv.jpg',
          alt: 'Basement waterproofing system installation in Stamford, Connecticut'
        },
        bullets: [
          { type: 'Review', text: '"Finished on time and spotless cleanup." - Stamford, CT', href: 'https://www.connecticutbasementsystems.com/about-us/reviews.html' },
          { type: 'Project', text: 'WaterGuard and TripleSafe install near Harbor Point.', href: 'https://www.connecticutbasementsystems.com/basement-waterproofing/photo-gallery.html' },
          { type: 'Before & After', text: 'Fairfield County basement transformation gallery.', href: 'https://www.connecticutbasementsystems.com/about-us/before-after.html' }
        ],
        cta: { label: 'See Stamford waterproofing results', href: 'https://www.connecticutbasementsystems.com/basement-waterproofing/photo-gallery.html' }
      }],
      ['Hartford, CT', {
        heading: 'Hartford structural highlights',
        summary: 'Historic homes downtown benefit from push pier stabilization and vapor protection.',
        image: {
          src: 'https://cdn.treehouseinternetgroup.com/cdn-cgi/image/format=auto/cms_images/7/fr-new-srv.jpg',
          alt: 'Foundation pier system being installed in Hartford, Connecticut'
        },
        bullets: [
          { type: 'Review', text: '"Crew respected our 1920s home and kept the site clean." - Hartford, CT', href: 'https://www.connecticutbasementsystems.com/about-us/reviews.html' },
          { type: 'Case Study', text: 'Foundation pier installation supporting a Capitol Ave duplex.', href: 'https://www.connecticutbasementsystems.com/about-us/case-studies.html' },
          { type: 'Project', text: 'Browse Hartford County foundation repair photos.', href: 'https://www.connecticutbasementsystems.com/foundation-repair/photo-gallery.html' }
        ],
        cta: { label: 'Review Hartford foundation projects', href: 'https://www.connecticutbasementsystems.com/foundation-repair/photo-gallery.html' }
      }],
      ['New Haven, CT', {
        heading: 'New Haven project snapshots',
        summary: 'Campus-area homes choose insulated wall panels and SaniDry systems to protect finished space.',
        image: {
          src: 'https://cdn.treehouseinternetgroup.com/cdn-cgi/image/format=auto/cms_images/7/tbf-new-srv.jpg',
          alt: 'Finished basement system installed in New Haven, Connecticut'
        },
        bullets: [
          { type: 'Review', text: '"Professional, on time, and clean." - New Haven, CT', href: 'https://www.connecticutbasementsystems.com/about-us/reviews.html' },
          { type: 'Project', text: 'Total Basement Finishing remodel off Chapel Street.', href: 'https://www.connecticutbasementsystems.com/basement-finishing/photo-gallery.html' },
          { type: 'Before & After', text: 'See basement finishing transformations across New Haven County.', href: 'https://www.connecticutbasementsystems.com/about-us/before-after.html' }
        ],
        cta: { label: 'See New Haven finishing ideas', href: 'https://www.connecticutbasementsystems.com/basement-finishing/photo-gallery.html' }
      }],
      ['Danbury, CT', {
        heading: 'Danbury project highlights',
        summary: 'Hillside properties around Candlewood Lake count on SmartJack supports and drainage upgrades.',
        image: {
          src: 'https://cdn.treehouseinternetgroup.com/cdn-cgi/image/format=auto/cms_images/7/sp-new-srv.jpg',
          alt: 'SmartJack support installation for a home near Danbury, Connecticut'
        },
        bullets: [
          { type: 'Review', text: '"Resolved cracks quickly and kept us informed." - Danbury, CT', href: 'https://www.connecticutbasementsystems.com/about-us/reviews.html' },
          { type: 'Case Study', text: 'SmartJack and CleanSpace upgrade in Fairfield County.', href: 'https://www.connecticutbasementsystems.com/about-us/case-studies.html' },
          { type: 'Project', text: 'See Danbury-area structural repair photos.', href: 'https://www.connecticutbasementsystems.com/foundation-repair/photo-gallery.html' }
        ],
        cta: { label: 'View Danbury structural projects', href: 'https://www.connecticutbasementsystems.com/foundation-repair/photo-gallery.html' }
      }],
      ['New London, CT', {
        heading: 'New London crawl space stories',
        summary: 'Coastal humidity control starts with CleanSpace encapsulation and SaniDry dehumidifiers.',
        image: {
          src: 'https://cdn.treehouseinternetgroup.com/cdn-cgi/image/format=auto/cms_images/7/cs-new-srv.jpg',
          alt: 'Crew encapsulating a crawl space near New London, Connecticut'
        },
        bullets: [
          { type: 'Review', text: '"Team knew exactly what to do." - New London, CT', href: 'https://www.connecticutbasementsystems.com/about-us/reviews.html' },
          { type: 'Project', text: 'CleanSpace encapsulation along the Thames River.', href: 'https://www.connecticutbasementsystems.com/crawl-space-repair/photo-gallery.html' },
          { type: 'Before & After', text: 'Crawl space makeovers in New London County.', href: 'https://www.connecticutbasementsystems.com/about-us/before-after.html' }
        ],
        cta: { label: 'Explore New London crawl space work', href: 'https://www.connecticutbasementsystems.com/crawl-space-repair/photo-gallery.html' }
      }],
      ['White Plains, NY', {
        heading: 'White Plains projects & reviews',
        summary: 'Westchester homeowners lean on perimeter drainage and structural reinforcements for peace of mind.',
        image: {
          src: 'https://cdn.treehouseinternetgroup.com/cms_images/7/wcu_inspection_1.jpg',
          alt: 'Technician inspecting a basement in White Plains, New York'
        },
        bullets: [
          { type: 'Review', text: '"Walked us through every step." - White Plains, NY', href: 'https://www.connecticutbasementsystems.com/about-us/reviews.html' },
          { type: 'Project', text: 'Waterproofing system upgrade near downtown White Plains.', href: 'https://www.connecticutbasementsystems.com/basement-waterproofing/photo-gallery.html' },
          { type: 'Case Study', text: 'See Westchester County repair stories.', href: 'https://www.connecticutbasementsystems.com/about-us/case-studies.html' }
        ],
        cta: { label: 'View White Plains waterproofing projects', href: 'https://www.connecticutbasementsystems.com/basement-waterproofing/photo-gallery.html' }
      }],
      ['Yonkers, NY', {
        heading: 'Yonkers structural spotlights',
        summary: 'Brick foundations and brownstones stay supported with push piers and carbon armor reinforcement.',
        image: {
          src: 'https://cdn.treehouseinternetgroup.com/cdn-cgi/image/format=auto/cms_images/7/fr-new-srv.jpg',
          alt: 'Foundation reinforcement system installed in Yonkers, New York'
        },
        bullets: [
          { type: 'Review', text: '"Tight timeline met without issue." - Yonkers, NY', href: 'https://www.connecticutbasementsystems.com/about-us/reviews.html' },
          { type: 'Project', text: 'Foundation wall stabilization near Getty Square.', href: 'https://www.connecticutbasementsystems.com/foundation-repair/photo-gallery.html' },
          { type: 'Case Study', text: 'See Yonkers and Bronxville repair case studies.', href: 'https://www.connecticutbasementsystems.com/about-us/case-studies.html' }
        ],
        cta: { label: 'Review Yonkers foundation work', href: 'https://www.connecticutbasementsystems.com/foundation-repair/photo-gallery.html' }
      }]
    ]);

    const zipToCity = new Map([
      ['06902', 'Stamford, CT'],
      ['06905', 'Stamford, CT'],
      ['06103', 'Hartford, CT'],
      ['06106', 'Hartford, CT'],
      ['06510', 'New Haven, CT'],
      ['06511', 'New Haven, CT'],
      ['06810', 'Danbury, CT'],
      ['06811', 'Danbury, CT'],
      ['06320', 'New London, CT'],
      ['06385', 'New London, CT'],
      ['10601', 'White Plains, NY'],
      ['10605', 'White Plains, NY'],
      ['10701', 'Yonkers, NY'],
      ['10710', 'Yonkers, NY']
    ]);

    const showcaseCard = document.getElementById('searchShowcase');
    const showcaseHeader = showcaseCard ? showcaseCard.querySelector('.showcase-header h2') : null;
    const showcaseSubhead = showcaseCard ? showcaseCard.querySelector('.showcase-header p') : null;
    const showcaseMedia = document.getElementById('showcaseMedia');
    const showcaseList = document.getElementById('showcaseList');
    const showcaseLink = document.getElementById('showcaseLink');
    const showcaseLinkLabel = showcaseLink ? showcaseLink.querySelector('.showcase-cta-label') : null;
    const defaultShowcaseHeading = showcaseHeader ? showcaseHeader.textContent : 'Project highlights';
    const defaultShowcaseSummary = showcaseSubhead ? showcaseSubhead.textContent : '';

    const heroCoverageMapEl = document.getElementById('heroCoverageMap');

    const ctBounds = [[40.98, -73.73], [42.05, -71.78]];
    const westchesterBounds = [[40.88, -74.1], [41.37, -73.3]];

    function initHeroCoverageMap() {
      if (!heroCoverageMapEl || typeof L === 'undefined') return;

      const coverageBounds = L.latLngBounds(ctBounds[0], ctBounds[1])
        .extend(westchesterBounds[0])
        .extend(westchesterBounds[1]);

      const heroMap = L.map(heroCoverageMapEl, {
        scrollWheelZoom: false,
        dragging: false,
        tap: false,
        doubleClickZoom: false,
        boxZoom: false,
        keyboard: false,
        zoomControl: false,
        attributionControl: false
      });

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(heroMap);

      L.rectangle(ctBounds, {
        color: '#d61f2c',
        weight: 1.5,
        fillColor: '#d61f2c',
        fillOpacity: 0.08
      }).addTo(heroMap);

      L.rectangle(westchesterBounds, {
        color: '#d61f2c',
        weight: 1.2,
        dashArray: '6',
        fillColor: '#d61f2c',
        fillOpacity: 0.06
      }).addTo(heroMap);

      heroMap.fitBounds(coverageBounds, { padding: [16, 16] });
    }

    const countyListEl = document.getElementById('countyList');
    const resultCountEl = document.getElementById('resultCount');
    const form = document.getElementById('coverageForm');
    function groupCities(data) {
      return data.reduce((acc, item) => {
        const key = item.county;
        if (!acc[key]) acc[key] = [];
        acc[key].push(item);
        return acc;
      }, {});
    }

    function renderList(data) {
      countyListEl.innerHTML = '';
      const grouped = groupCities(data);
      const counties = Object.keys(grouped).sort();
      resultCountEl.textContent = data.length;

      if (data.length === 0) {
        const empty = document.createElement('p');
        empty.style.color = 'var(--muted)';
        empty.textContent = 'No matching cities. Try a different search or call us directly.';
        countyListEl.append(empty);
        return;
      }

      counties.forEach(county => {
        const details = document.createElement('details');
        details.className = 'county';
        details.open = counties.length <= 3;

        const summary = document.createElement('summary');
        summary.textContent = `${county} County (${grouped[county].length})`;
        details.append(summary);

        const countySummary = document.createElement('div');
        countySummary.className = 'county-summary';
        const topService = getTopCountyService(grouped[county]);
        countySummary.innerHTML = `<strong>${topService}</strong> is the most-requested service here. Need help fast? <a href="tel:1-203-723-1372">Call 1-203-723-1372</a>.`;
        details.append(countySummary);

        const cityGrid = document.createElement('div');
        cityGrid.className = 'city-grid';

        grouped[county]
          .sort((a, b) => a.city.localeCompare(b.city))
          .forEach(city => {
            const row = document.createElement('a');
            row.className = 'city-row';
            row.href = city.url;
            row.setAttribute('data-city-id', city.id);
            row.setAttribute('data-county', city.county);
            row.setAttribute('data-services', city.services.join('|'));
            row.setAttribute('aria-label', `View coverage details for ${city.city}, ${city.state}`);

            row.innerHTML = `
              <div class="city-main">
                <div class="city-heading">
                  <span class="city-name">${city.city}, ${city.state}</span>
                  ${city.flagshipService ? `<span class="city-flagship">${city.flagshipService}</span>` : ''}
                </div>
                <div class="city-services">
                  ${buildServiceTags(city.services)}
                </div>
              </div>
              <div class="city-meta">
                ${city.responseTime ? `<span class="city-response">Typical response: ${city.responseTime}</span>` : ''}
                ${city.reviewSnippet ? `<span class="city-review">“${city.reviewSnippet}”</span>` : ''}
                <span class="city-cta">View city page →</span>
              </div>
            `.trim();

            cityGrid.append(row);
          });

        details.append(cityGrid);
        countyListEl.append(details);
      });
    }

    function buildServiceTags(services) {
      return services
        .map(service => `<span class="service-tag">${service}</span>`)
        .join('');
    }

    function getTopCountyService(items) {
      const counts = items.reduce((acc, city) => {
        city.services.forEach(service => {
          acc[service] = (acc[service] || 0) + 1;
        });
        return acc;
      }, {});
      const sorted = Object.entries(counts).sort((a, b) => b[1] - a[1]);
      return sorted.length ? sorted[0][0] : 'Basement Waterproofing';
    }

    function resetShowcase() {
      if (!showcaseCard || !showcaseMedia || !showcaseList || !showcaseLink) return;
      showcaseMedia.innerHTML = '';
      showcaseMedia.hidden = true;
      showcaseList.innerHTML = '';
      showcaseLink.hidden = true;
      showcaseLink.href = '#';
      if (showcaseLinkLabel) {
        showcaseLinkLabel.textContent = 'View more on ConnecticutBasementSystems.com';
      }
      if (showcaseHeader) {
        showcaseHeader.textContent = defaultShowcaseHeading;
      }
      if (showcaseSubhead) {
        showcaseSubhead.textContent = defaultShowcaseSummary;
      }
    }

    function renderShowcase(data) {
      if (!showcaseCard || !showcaseMedia || !showcaseList || !showcaseLink) return;
      showcaseCard.hidden = false;

      if (showcaseHeader) {
        showcaseHeader.textContent = data.heading || defaultShowcaseHeading;
      }
      if (showcaseSubhead) {
        showcaseSubhead.textContent = data.summary || defaultShowcaseSummary;
      }

      showcaseMedia.innerHTML = '';
      if (data.image && data.image.src) {
        const img = document.createElement('img');
        img.src = data.image.src;
        if (data.image.alt) {
          img.alt = data.image.alt;
        }
        img.loading = 'lazy';
        showcaseMedia.append(img);
        showcaseMedia.hidden = false;
      } else {
        showcaseMedia.hidden = true;
      }

      showcaseList.innerHTML = '';
      if (Array.isArray(data.bullets) && data.bullets.length) {
        data.bullets.forEach(item => {
          const li = document.createElement('li');
          if (item.type) {
            const strong = document.createElement('strong');
            strong.textContent = item.type;
            li.append(strong);
          }
          const node = document.createElement(item.href ? 'a' : 'span');
          node.textContent = item.text;
          if (item.href) {
            node.href = item.href;
            node.target = '_blank';
            node.rel = 'noopener';
          }
          li.append(node);
          showcaseList.append(li);
        });
      } else {
        const li = document.createElement('li');
        li.textContent = 'Call 1-203-723-1372 for recent project details in your neighborhood.';
        showcaseList.append(li);
      }

      if (data.cta && data.cta.href) {
        showcaseLink.hidden = false;
        showcaseLink.href = data.cta.href;
        showcaseLink.target = data.cta.target || '_blank';
        if (showcaseLinkLabel) {
          showcaseLinkLabel.textContent = data.cta.label || 'See more projects';
        }
      } else {
        showcaseLink.hidden = true;
        showcaseLink.href = '#';
        if (showcaseLinkLabel) {
          showcaseLinkLabel.textContent = 'View more on ConnecticutBasementSystems.com';
        }
      }
    }

    function resolveShowcaseKey(rawSearch, results) {
      const trimmed = (rawSearch || '').trim();
      if (!trimmed) return 'DEFAULT';

      const digits = trimmed.replace(/[^0-9]/g, '');
      if (digits.length >= 5) {
        const zipMatch = zipToCity.get(digits);
        if (zipMatch) {
          return zipMatch;
        }
      }

      const normalized = trimmed.toLowerCase();
      for (const [key] of showcaseData.entries()) {
        if (key === 'DEFAULT') continue;
        if (key.toLowerCase().includes(normalized)) {
          return key;
        }
      }

      for (const item of results) {
        const candidate = `${item.city}, ${item.state}`;
        if (showcaseData.has(candidate)) {
          return candidate;
        }
      }

      return 'DEFAULT';
    }

    function updateShowcase(rawSearch, results) {
      if (!showcaseCard) return;
      const trimmed = (rawSearch || '').trim();
      if (!trimmed) {
        showcaseCard.hidden = true;
        resetShowcase();
        return;
      }

      const key = resolveShowcaseKey(trimmed, results);
      const data = showcaseData.get(key) || showcaseData.get('DEFAULT');
      renderShowcase(data);
    }

    function applyFilters(event) {
      if (event) event.preventDefault();
      const rawSearch = (form.city.value || '').trim();
      const search = rawSearch.toLowerCase();
      const digits = rawSearch.replace(/[^0-9]/g, '');
      const zipTarget = digits.length >= 5 ? zipToCity.get(digits) : '';
      const targetedCityKey = zipTarget ? zipTarget.toLowerCase() : '';
      const service = form.service.value || '';
      const county = form.county.value || '';

      const filtered = coverageData.filter(item => {
        const cityKey = `${item.city}, ${item.state}`.toLowerCase();
        const matchesZipCity = targetedCityKey && cityKey === targetedCityKey;
        const matchesSearch = !search || `${item.city} ${item.state}`.toLowerCase().includes(search) || matchesZipCity;
        const matchesService = !service || item.services.includes(service);
        const matchesCounty = !county || item.county.toLowerCase() === county.toLowerCase();
        return matchesSearch && matchesService && matchesCounty;
      });

      renderList(filtered);
      updateShowcase(rawSearch, filtered);
    }

    form.addEventListener('submit', applyFilters);
    form.city.addEventListener('input', () => applyFilters());
    form.service.addEventListener('change', applyFilters);
    form.county.addEventListener('change', applyFilters);

    initHeroCoverageMap();
    renderList(coverageData);
    resetShowcase();
  </script>
</body>
</html>
