<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Service Area – Connecticut &amp; Westchester County</title>
  <meta name="description" content="Check whether we serve your city in Connecticut or Westchester County, NY." />
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

  <style>
    :root {
      --bg: #f5f7fb;
      --surface: #ffffff;
      --ink: #101828;
      --muted: #475467;
      --accent: #d61f2c;
      --accent-dark: #aa1c23;
      --brand: #113a6a;
      --border: #d8dee8;
      --radius: 16px;
      --shadow: 0 18px 36px rgba(16, 26, 53, 0.08);
      --container: min(1100px, 92vw);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Manrope", system-ui, -apple-system, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--ink);
      line-height: 1.6;
    }

    img {
      max-width: 100%;
      display: block;
    }

    a {
      color: inherit;
    }

    .container {
      width: var(--container);
      margin-inline: auto;
    }

    header.page-hero {
      background: radial-gradient(circle at top left, rgba(214, 31, 44, 0.18), transparent 55%),
        linear-gradient(180deg, #ffffff 0%, #eef2fb 100%);
      padding: clamp(40px, 8vw, 80px) 0;
    }

    .hero-shell {
      display: grid;
      gap: clamp(24px, 4vw, 40px);
    }

    @media (min-width: 900px) {
      .hero-shell {
        grid-template-columns: minmax(0, 1.4fr) minmax(260px, 1fr);
        align-items: start;
      }
    }

    .hero-shell h1 {
      margin: 0;
      font-size: clamp(32px, 5vw, 48px);
      line-height: 1.08;
      color: var(--brand);
    }

    .hero-shell p {
      margin: 12px 0 24px;
      color: var(--muted);
      max-width: 60ch;
    }

    .hero-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 24px;
    }

    .hero-tags span {
      background: rgba(16, 58, 106, 0.08);
      border: 1px solid rgba(16, 58, 106, 0.16);
      color: var(--brand);
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .hero-copy {
      display: grid;
      gap: 18px;
    }

    .hero-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .hero-map-card {
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: clamp(18px, 3vw, 26px);
      display: grid;
      gap: 10px;
    }

    .hero-map-card p {
      margin: 0;
      color: var(--muted);
      font-size: 0.9rem;
    }

    .hero-map {
      height: clamp(220px, 30vw, 320px);
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid rgba(17, 58, 106, 0.18);
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 18px;
      border-radius: 12px;
      border: 1px solid transparent;
      font-weight: 700;
      text-decoration: none;
      cursor: pointer;
    }

    .btn-primary {
      background: var(--accent);
      color: #fff;
      box-shadow: 0 16px 24px rgba(214, 31, 44, 0.18);
    }

    .btn-primary:hover {
      background: var(--accent-dark);
    }

    .btn-ghost {
      background: #fff;
      border-color: rgba(16, 58, 106, 0.18);
      color: var(--brand);
    }

    .finder {
      margin-top: clamp(-32px, -5vw, -56px);
      position: relative;
      z-index: 5;
    }

    .finder-card {
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: clamp(24px, 4vw, 36px);
      display: grid;
      gap: 18px;
    }

    .finder-card h2 {
      margin: 0;
      font-size: clamp(24px, 3.5vw, 32px);
      color: var(--brand);
    }

    .finder-form {
      display: grid;
      gap: 16px;
    }

    @media (min-width: 720px) {
      .finder-form {
        grid-template-columns: repeat(4, minmax(0, 1fr));
        align-items: end;
      }
    }

    label {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--muted);
      display: block;
      margin-bottom: 6px;
    }

    input,
    select {
      width: 100%;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid var(--border);
      font: inherit;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }

    input:focus,
    select:focus {
      outline: none;
      border-color: rgba(214, 31, 44, 0.4);
      box-shadow: 0 0 0 4px rgba(214, 31, 44, 0.12);
    }

    .coverage {
      padding: clamp(40px, 7vw, 72px) 0;
    }

    .coverage-grid {
      display: grid;
      gap: clamp(24px, 4vw, 36px);
      grid-template-columns: minmax(0, 1fr);
    }

    @media (min-width: 940px) {
      .coverage-grid {
        grid-template-columns: minmax(280px, 340px) minmax(0, 1fr);
      }
    }

    .map-card,
    .list-card {
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: clamp(20px, 3vw, 28px);
    }

    #coverageMap {
      height: 340px;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid rgba(16, 58, 106, 0.18);
    }

    .list-header {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 18px;
    }

    .list-header p {
      margin: 0;
      color: var(--muted);
    }

    details.county {
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #fff;
      margin-bottom: 12px;
      overflow: hidden;
    }

    summary {
      padding: 14px 18px;
      font-weight: 700;
      cursor: pointer;
      list-style: none;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    summary::after {
      content: "";
      width: 10px;
      height: 10px;
      border-right: 2px solid var(--ink);
      border-bottom: 2px solid var(--ink);
      transform: rotate(45deg);
      transition: transform 0.2s ease;
    }

    details[open] summary::after {
      transform: rotate(-135deg);
    }

    .city-grid {
      padding: 0 18px 18px;
      display: grid;
      gap: 10px;
    }

    .city-row {
      display: flex;
      flex-direction: column;
      gap: 4px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 12px;
    }

    .city-row:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }

    .city-name {
      font-weight: 600;
    }

    .city-services {
      color: var(--muted);
      font-size: 0.85rem;
    }

    .proof {
      padding: clamp(32px, 6vw, 56px) 0;
    }

    .proof-grid {
      display: grid;
      gap: clamp(18px, 3vw, 28px);
    }

    @media (min-width: 720px) {
      .proof-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .proof-card {
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: clamp(20px, 3vw, 28px);
    }

    .proof-card h3 {
      margin: 0 0 10px;
      font-size: 1.2rem;
    }

    .proof-card p {
      margin: 6px 0;
      color: var(--muted);
      font-size: 0.95rem;
    }

    .faq {
      padding: clamp(32px, 6vw, 56px) 0;
    }

    .faq details {
      margin-bottom: 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--surface);
      box-shadow: var(--shadow);
    }

    .faq summary {
      padding: 16px 20px;
    }

    .faq p {
      padding: 0 20px 18px;
      margin: 0;
      color: var(--muted);
    }

    .cta-strip {
      background: linear-gradient(135deg, var(--brand), #0c223d);
      color: #fff;
      padding: clamp(32px, 6vw, 52px) 0;
    }

    .cta-strip .shell {
      display: grid;
      gap: 16px;
      align-items: center;
      justify-items: center;
      text-align: center;
    }

    @media (min-width: 720px) {
      .cta-strip .shell {
        grid-template-columns: 1fr auto;
        text-align: left;
        justify-items: start;
      }
    }
  </style>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet" />
</head>
<body>
  <header class="page-hero">
    <div class="container hero-shell">
      <div class="hero-copy">
        <h1>Serving every corner of Connecticut and Westchester County, NY.</h1>
        <p>Search by city, ZIP, service, or county to see how quickly we can be on site. If you do not see your community listed, give us a call—there is a strong chance we already work there.</p>
        <div class="hero-tags">
          <span>Same-week inspections</span>
          <span>Emergency leak response</span>
          <span>4.9 out of 5 homeowner reviews</span>
        </div>
        <div class="hero-actions">
          <a class="btn btn-primary" href="#finder">Check coverage</a>
          <a class="btn btn-ghost" href="tel:1-203-723-1372">Call 1-203-723-1372</a>
        </div>
      </div>
      <aside class="hero-map-card" aria-label="Coverage highlight">
        <strong style="font-size:1.05rem">Coverage snapshot</strong>
        <p>Shaded counties show our daily service area across Connecticut and Westchester County, NY.</p>
        <div class="hero-map" id="heroCoverageMap" role="presentation"></div>
      </aside>
    </div>
  </header>

  <section class="finder" id="finder">
    <div class="container finder-card" role="search">
      <h2>Find out if we service your address</h2>
      <form class="finder-form" id="coverageForm">
        <div>
          <label for="cityZip">City or ZIP</label>
          <input id="cityZip" name="city" placeholder="e.g. Stamford or 06902" inputmode="search" />
        </div>
        <div>
          <label for="serviceSelect">Service</label>
          <select id="serviceSelect" name="service">
            <option value="">All services</option>
            <option>Basement Waterproofing</option>
            <option>Foundation Repair</option>
            <option>Crawl Space Repair</option>
            <option>Concrete Leveling</option>
            <option>Basement Finishing</option>
          </select>
        </div>
        <div>
          <label for="countySelect">County</label>
          <select id="countySelect" name="county">
            <option value="">All counties</option>
            <option>Fairfield</option>
            <option>Hartford</option>
            <option>Litchfield</option>
            <option>Middlesex</option>
            <option>New Haven</option>
            <option>New London</option>
            <option>Tolland</option>
            <option>Windham</option>
            <option>Westchester</option>
          </select>
        </div>
        <div>
          <button class="btn btn-primary" type="submit">Show matches</button>
        </div>
      </form>
    </div>
  </section>

  <section class="coverage" aria-label="Coverage map and city list">
    <div class="container coverage-grid">
      <aside class="map-card">
        <h2 style="margin-top:0">Coverage map</h2>
        <p style="color:var(--muted); margin-top:6px">Explore a live view of recent service appointments across Connecticut and Westchester County.</p>
        <div id="coverageMap" role="presentation"></div>
      </aside>

      <section class="list-card" aria-live="polite">
        <div class="list-header">
          <h2 style="margin:0">Cities we serve</h2>
          <p><span id="resultCount">0</span> communities match your filters.</p>
        </div>
        <div id="countyList"></div>
      </section>
    </div>
  </section>

  <section class="proof">
    <div class="container proof-grid">
      <article class="proof-card">
        <h3>Recent jobs nearby</h3>
        <p>Norwalk, CT • Sump system &amp; WaterGuard • Aug 23, 2025</p>
        <p>Danbury, CT • Foundation piering • Aug 20, 2025</p>
        <p>Scarsdale, NY • Concrete leveling • Aug 12, 2025</p>
      </article>
      <article class="proof-card">
        <h3>Reviews from Connecticut homeowners</h3>
        <p>“Incredible crew. Dry basement after the first storm.” <br /><small style="color:var(--muted)">– New Haven, CT</small></p>
        <p>“Professional, on time, and clean.” <br /><small style="color:var(--muted)">– Greenwich, CT</small></p>
      </article>
    </div>
  </section>

  <section class="faq" aria-label="Frequently asked questions">
    <div class="container">
      <details open>
        <summary>Do you service my town?</summary>
        <p>Yes. We cover every city and town in Connecticut along with all of Westchester County, NY. Use the search form above to confirm and schedule.</p>
      </details>
      <details>
        <summary>What services are available?</summary>
        <p>Basement waterproofing, foundation repair, crawl space repair, concrete leveling, and basement finishing. Availability may vary by project type—call us for specifics.</p>
      </details>
      <details>
        <summary>How soon can you visit?</summary>
        <p>Most inspections are scheduled within the same week. Emergency requests are prioritised—call for immediate assistance.</p>
      </details>
    </div>
  </section>

  <div class="cta-strip" role="region" aria-label="Book an estimate">
    <div class="container shell">
      <strong>Evening and weekend appointments available.</strong>
      <div class="hero-actions">
        <a class="btn btn-ghost" href="tel:1-203-723-1372">Call 1-203-723-1372</a>
        <a class="btn btn-primary" href="#finder">Request my free estimate</a>
      </div>
    </div>
  </div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <script>
    const coverageData = [
      { id: 1, city: 'Stamford', state: 'CT', county: 'Fairfield', lat: 41.0534, lng: -73.5387, services: ['Basement Waterproofing', 'Foundation Repair', 'Concrete Leveling'] },
      { id: 2, city: 'Bridgeport', state: 'CT', county: 'Fairfield', lat: 41.1792, lng: -73.1894, services: ['Basement Waterproofing', 'Crawl Space Repair'] },
      { id: 3, city: 'Norwalk', state: 'CT', county: 'Fairfield', lat: 41.1177, lng: -73.4079, services: ['Basement Waterproofing', 'Foundation Repair'] },
      { id: 4, city: 'Danbury', state: 'CT', county: 'Fairfield', lat: 41.3948, lng: -73.454, services: ['Foundation Repair', 'Concrete Leveling'] },
      { id: 5, city: 'Greenwich', state: 'CT', county: 'Fairfield', lat: 41.0262, lng: -73.6282, services: ['Basement Waterproofing', 'Foundation Repair', 'Basement Finishing'] },
      { id: 6, city: 'New Canaan', state: 'CT', county: 'Fairfield', lat: 41.1468, lng: -73.4948, services: ['Basement Waterproofing', 'Crawl Space Repair'] },

      { id: 7, city: 'Hartford', state: 'CT', county: 'Hartford', lat: 41.7658, lng: -72.6734, services: ['Basement Waterproofing', 'Foundation Repair'] },
      { id: 8, city: 'West Hartford', state: 'CT', county: 'Hartford', lat: 41.762, lng: -72.742, services: ['Basement Waterproofing', 'Crawl Space Repair'] },
      { id: 9, city: 'East Hartford', state: 'CT', county: 'Hartford', lat: 41.7634, lng: -72.612, services: ['Foundation Repair', 'Concrete Leveling'] },
      { id: 10, city: 'New Britain', state: 'CT', county: 'Hartford', lat: 41.6612, lng: -72.7795, services: ['Basement Waterproofing', 'Basement Finishing'] },
      { id: 11, city: 'Glastonbury', state: 'CT', county: 'Hartford', lat: 41.7123, lng: -72.608, services: ['Basement Waterproofing', 'Crawl Space Repair'] },
      { id: 12, city: 'Manchester', state: 'CT', county: 'Hartford', lat: 41.7759, lng: -72.5215, services: ['Foundation Repair', 'Concrete Leveling'] },

      { id: 13, city: 'Waterbury', state: 'CT', county: 'New Haven', lat: 41.5582, lng: -73.0515, services: ['Foundation Repair', 'Concrete Leveling'] },
      { id: 14, city: 'New Haven', state: 'CT', county: 'New Haven', lat: 41.3083, lng: -72.9279, services: ['Basement Waterproofing', 'Foundation Repair'] },
      { id: 15, city: 'Milford', state: 'CT', county: 'New Haven', lat: 41.2307, lng: -73.064, services: ['Basement Waterproofing', 'Crawl Space Repair'] },
      { id: 16, city: 'Hamden', state: 'CT', county: 'New Haven', lat: 41.3959, lng: -72.8968, services: ['Basement Waterproofing', 'Crawl Space Repair'] },
      { id: 17, city: 'Meriden', state: 'CT', county: 'New Haven', lat: 41.5382, lng: -72.807, services: ['Foundation Repair', 'Concrete Leveling'] },
      { id: 18, city: 'West Haven', state: 'CT', county: 'New Haven', lat: 41.2707, lng: -72.946, services: ['Basement Waterproofing', 'Foundation Repair'] },

      { id: 19, city: 'Middletown', state: 'CT', county: 'Middlesex', lat: 41.5623, lng: -72.6506, services: ['Basement Waterproofing', 'Crawl Space Repair', 'Concrete Leveling'] },
      { id: 20, city: 'Cromwell', state: 'CT', county: 'Middlesex', lat: 41.5951, lng: -72.6454, services: ['Foundation Repair', 'Concrete Leveling'] },
      { id: 21, city: 'Old Saybrook', state: 'CT', county: 'Middlesex', lat: 41.2915, lng: -72.3762, services: ['Basement Waterproofing', 'Crawl Space Repair'] },

      { id: 22, city: 'New London', state: 'CT', county: 'New London', lat: 41.3557, lng: -72.0995, services: ['Basement Waterproofing', 'Foundation Repair'] },
      { id: 23, city: 'Norwich', state: 'CT', county: 'New London', lat: 41.5243, lng: -72.0759, services: ['Foundation Repair', 'Concrete Leveling'] },
      { id: 24, city: 'Groton', state: 'CT', county: 'New London', lat: 41.3501, lng: -72.0782, services: ['Basement Waterproofing', 'Crawl Space Repair'] },
      { id: 25, city: 'Waterford', state: 'CT', county: 'New London', lat: 41.3418, lng: -72.1356, services: ['Basement Waterproofing', 'Foundation Repair'] },

      { id: 26, city: 'Torrington', state: 'CT', county: 'Litchfield', lat: 41.8007, lng: -73.1212, services: ['Foundation Repair', 'Concrete Leveling'] },
      { id: 27, city: 'New Milford', state: 'CT', county: 'Litchfield', lat: 41.577, lng: -73.4085, services: ['Basement Waterproofing', 'Crawl Space Repair'] },
      { id: 28, city: 'Litchfield', state: 'CT', county: 'Litchfield', lat: 41.7473, lng: -73.1887, services: ['Basement Waterproofing', 'Foundation Repair'] },
      { id: 29, city: 'Thomaston', state: 'CT', county: 'Litchfield', lat: 41.6737, lng: -73.0743, services: ['Foundation Repair', 'Concrete Leveling'] },

      { id: 30, city: 'Vernon', state: 'CT', county: 'Tolland', lat: 41.8665, lng: -72.4495, services: ['Basement Waterproofing', 'Foundation Repair'] },
      { id: 31, city: 'Tolland', state: 'CT', county: 'Tolland', lat: 41.8715, lng: -72.3687, services: ['Basement Waterproofing', 'Crawl Space Repair'] },
      { id: 32, city: 'Ellington', state: 'CT', county: 'Tolland', lat: 41.9037, lng: -72.4698, services: ['Foundation Repair', 'Concrete Leveling'] },

      { id: 33, city: 'Windham', state: 'CT', county: 'Windham', lat: 41.6998, lng: -72.157, services: ['Basement Waterproofing', 'Foundation Repair'] },
      { id: 34, city: 'Putnam', state: 'CT', county: 'Windham', lat: 41.9151, lng: -71.9087, services: ['Basement Waterproofing', 'Crawl Space Repair'] },
      { id: 35, city: 'Killingly', state: 'CT', county: 'Windham', lat: 41.8415, lng: -71.887, services: ['Foundation Repair', 'Concrete Leveling'] },

      { id: 36, city: 'White Plains', state: 'NY', county: 'Westchester', lat: 41.033, lng: -73.7629, services: ['Foundation Repair', 'Concrete Leveling', 'Basement Waterproofing'] },
      { id: 37, city: 'Yonkers', state: 'NY', county: 'Westchester', lat: 40.9312, lng: -73.8988, services: ['Basement Waterproofing', 'Foundation Repair'] },
      { id: 38, city: 'New Rochelle', state: 'NY', county: 'Westchester', lat: 40.9115, lng: -73.7824, services: ['Basement Waterproofing', 'Crawl Space Repair'] },
      { id: 39, city: 'Mount Vernon', state: 'NY', county: 'Westchester', lat: 40.9126, lng: -73.8371, services: ['Foundation Repair', 'Concrete Leveling'] },
      { id: 40, city: 'Port Chester', state: 'NY', county: 'Westchester', lat: 41.0018, lng: -73.6657, services: ['Basement Waterproofing', 'Foundation Repair'] }
    ];

    const countyListEl = document.getElementById('countyList');
    const resultCountEl = document.getElementById('resultCount');
    const form = document.getElementById('coverageForm');

    const ctBounds = [[40.98, -73.73], [42.05, -71.78]];
    const westchesterBounds = [[40.88, -74.1], [41.37, -73.3]];
    const coverageBounds = L.latLngBounds(ctBounds[0], ctBounds[1]).extend(westchesterBounds[0]).extend(westchesterBounds[1]);

    const heroMap = L.map('heroCoverageMap', {
      scrollWheelZoom: false,
      dragging: false,
      tap: false,
      doubleClickZoom: false,
      boxZoom: false,
      keyboard: false
    });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(heroMap);
    L.rectangle(ctBounds, {
      color: '#d61f2c',
      weight: 1.5,
      fillColor: '#d61f2c',
      fillOpacity: 0.08
    }).addTo(heroMap);
    L.rectangle(westchesterBounds, {
      color: '#d61f2c',
      weight: 1.2,
      dashArray: '6',
      fillColor: '#d61f2c',
      fillOpacity: 0.06
    }).addTo(heroMap);
    heroMap.fitBounds(coverageBounds, { padding: [12, 12] });

    const resultsMap = L.map('coverageMap', { scrollWheelZoom: false, tap: false }).setView([41.5, -72.7], 8);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(resultsMap);
    const markerGroup = L.layerGroup().addTo(resultsMap);

    function groupCities(data) {
      return data.reduce((acc, item) => {
        const key = item.county;
        if (!acc[key]) acc[key] = [];
        acc[key].push(item);
        return acc;
      }, {});
    }

    function renderList(data) {
      countyListEl.innerHTML = '';
      const grouped = groupCities(data);
      const counties = Object.keys(grouped).sort();
      resultCountEl.textContent = data.length;

      if (data.length === 0) {
        const empty = document.createElement('p');
        empty.style.color = 'var(--muted)';
        empty.textContent = 'No matching cities. Try a different search or call us directly.';
        countyListEl.append(empty);
        return;
      }

      counties.forEach(county => {
        const details = document.createElement('details');
        details.className = 'county';
        details.open = counties.length <= 3;

        const summary = document.createElement('summary');
        summary.textContent = `${county} County (${grouped[county].length})`;
        details.append(summary);

        const cityGrid = document.createElement('div');
        cityGrid.className = 'city-grid';

        grouped[county]
          .sort((a, b) => a.city.localeCompare(b.city))
          .forEach(city => {
            const row = document.createElement('div');
            row.className = 'city-row';

            const name = document.createElement('div');
            name.className = 'city-name';
            name.textContent = `${city.city}, ${city.state}`;
            row.append(name);

            const services = document.createElement('div');
            services.className = 'city-services';
            services.textContent = city.services.join(', ');
            row.append(services);

            cityGrid.append(row);
          });

        details.append(cityGrid);
        countyListEl.append(details);
      });
    }

    function applyFilters(event) {
      if (event) event.preventDefault();
      const search = (form.city.value || '').trim().toLowerCase();
      const service = form.service.value || '';
      const county = form.county.value || '';

      const filtered = coverageData.filter(item => {
        const matchesSearch = !search || `${item.city} ${item.state}`.toLowerCase().includes(search);
        const matchesService = !service || item.services.includes(service);
        const matchesCounty = !county || item.county.toLowerCase() === county.toLowerCase();
        return matchesSearch && matchesService && matchesCounty;
      });

      renderList(filtered);
      updateMap(filtered);
    }

    form.addEventListener('submit', applyFilters);
    form.city.addEventListener('input', () => applyFilters());
    form.service.addEventListener('change', applyFilters);
    form.county.addEventListener('change', applyFilters);

    function updateMap(data) {
      markerGroup.clearLayers();

      if (!data.length) {
        resultsMap.fitBounds(coverageBounds, { padding: [24, 24] });
        return;
      }

      data.forEach(item => {
        if (typeof item.lat !== 'number' || typeof item.lng !== 'number') return;
        const marker = L.marker([item.lat, item.lng]);
        marker.bindPopup(`<strong>${item.city}, ${item.state}</strong><br>${item.services.join(', ')}`);
        markerGroup.addLayer(marker);
      });

      if (markerGroup.getLayers().length) {
        resultsMap.fitBounds(markerGroup.getBounds().extend(coverageBounds), { padding: [24, 24] });
      }
    }

    renderList(coverageData);
    updateMap(coverageData);
  </script>
</body>
</html>
